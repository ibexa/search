services:
    Ibexa\Search\View\SearchViewProvider:
        arguments:
            $matcherFactory: '@ibexa.platform.user.view.search.matcher_factory.dynamically_configured'
        tags:
            - { name: ezpublish.view_provider, type: Ibexa\Search\View\SearchView, priority: 10 }

    ibexa.platform.view.search.matcher_factory:
        class: Ibexa\Bundle\Core\Matcher\ServiceAwareMatcherFactory
        arguments:
            $viewMatcherRegistry: '@Ibexa\Bundle\Core\Matcher\ViewMatcherRegistry'
            $repository: '@ezpublish.api.repository'
            $relativeNamespace: Ibexa\Search\View

    ibexa.platform.user.view.search.matcher_factory.dynamically_configured:
        class: Ibexa\Core\MVC\Symfony\Matcher\DynamicallyConfiguredMatcherFactoryDecorator
        decorates: ibexa.platform.view.search.matcher_factory
        arguments:
            $innerConfigurableMatcherFactory: '@ibexa.platform.user.view.search.matcher_factory.dynamically_configured.inner'
            $configResolver: '@ezpublish.config.resolver'
            $parameterName: search_view

    Ibexa\Search\View\SearchViewFilter:
        arguments:
            $configResolver: '@ezpublish.config.resolver'
            $formFactory: '@Symfony\Component\Form\FormFactoryInterface'
            $sectionService: '@ezpublish.api.service.section'
            $contentTypeService: '@ezpublish.api.service.content_type'
            $urlGenerator: '@router'
        tags:
            - { name: kernel.event_subscriber }

    Ibexa\Search\View\SearchViewBuilder:
        arguments:
            $viewConfigurator: '@ezpublish.view.configurator'
            $viewParametersInjector: '@ezpublish.view.view_parameters.injector.dispatcher'
            $searchService: '@ezpublish.api.service.search'
            $pagerSearchContentToDataMapper: '@Ibexa\Search\Mapper\PagerSearchContentToDataMapper'
            $searchQueryType: '@Ibexa\Search\QueryType\SearchQueryType'
        tags:
            - { name: ibexa.view_builder }
